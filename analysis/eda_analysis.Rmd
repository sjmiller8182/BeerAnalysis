---
title: "CDA and EDA"
author: "Kevin Thompson and Stuart Miller"
date: "June 14, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# Setup

### Load Libraries

```{r libraries, echo=TRUE, message=FALSE}
library(tidyverse)
library(naniar)
library(reshape2)
library(pastecs)
```

### Load Data

Be sure to run `make` in `./analysis/data` first to build data file.

```{r load_data, echo=TRUE}
load('./data/.RData')
```

## Introduction

TODO: Add an introduciton to the project

## Analysis Questions

The following questions were used to drive the data exploration.

### Question 1

How many breweries are present in each state?

```{r fig.width=15, fig.height=7, echo=TRUE}
# get counts of breweries per state
merged_data %>% 
  group_by(State) %>% 
  summarise(breweries_per_state = length(State)) %>%
  ggplot(aes(x=reorder(State, -breweries_per_state), y=breweries_per_state)) +
  geom_col() +
  xlab('State') +
  ylab('Count') +
  ggtitle('Brewery Count per State')
```

Above is a plot of the number of breweries per state for each state and Washington DC.

About one-third of the states have more than 10 breweries, while the other two-thirds have less than 10. There are 47 breweries in Colorado and 39 in Califoria, which are the top two states by brewery count. The bottom three states by brewery count with just one brewery per state are North Dakota, South Dakota, and West Virginia. There is also only one brewery in Washington DC.

### Question 2

Print the first 6 observations and the last six observations to check the merged file. Print 'head' and 'tail' of merged data to verify merge data looks correct.

```{r, echo=TRUE}
head(merged_data)
tail(merged_data)
```

Based on the first 6 and last 6 rows of the merged data, the merge appears to have been executed correctly. Note that this would only catch gross errors from the merge.

### Question 3

Report the number of NA's in each column.

```{r}
merged_data %>%
  miss_var_summary()
```

The table below, shows the number of missing values (`NA`) for `IBU`, `ABV`, `Style`, and `ShortStyle`. A large portion of the `IBU` values are missing, which would affect insightes related to `IBU`. The number of missing values for `ABV` is less significant, but caution should be taken when working with this column. The other two columns are missing less than 1% of the rows.

| Column Name   | Number of Missing Values| Percent of Values Missing|
|:-------------:|------------------------:|-------------------------:|
| IBU           | 1005                    |41.70%                    |
| ABV           | 62                      |2.57%                     |
| Style         | 5                       |0.21%                     |
| ShortStyle    | 5                       |0.21%                     |

Because only 2.57% of ABV is missing and there is no indication of a pattern for the missingness, we are comfortable assuming we can recover a consistent estimate of the mean for Alcohol-By-Volume after list-wise deletion of missing data. We turn to the question of missingness in IBU, which is a more complicated topic. 

TODO: Missingness of IBU and recoverability of mean IBU. 

### Question 4

Compute the median alcohol content and international bitterness unit for each state. Plot a bar chart to compare.

```{r, echo=TRUE}
# calc summary stats for ABV and IBU
summary_df <- merged_data %>% 
  remove_missing(na.rm=TRUE) %>%
  group_by(State) %>% 
  summarise(MeanABV=mean(ABV), MaxABV=max(ABV), MinABV=min(ABV), MedianABV=median(ABV), StdABV=sd(ABV),
            MeanIBU=mean(IBU), MaxIBU=max(IBU), MinABV=min(IBU), MedianIBU=median(IBU), StdIBU=sd(IBU))
```


```{r fig.width=15, fig.height=7, echo=TRUE}
summary_df %>%
  ggplot(aes(x=reorder(State, -MedianIBU), y=MedianIBU)) +
  geom_col() +
  labs(title="Median IBU by State", x="State", y="Median IBU")
```

The plot above shows the median IBU values per state. The medians range from 61 to 19 with the highest median from Maine and the lowest median from Wisconsin.

```{r fig.width=15, fig.height=7, echo=TRUE}
summary_df %>%
  ggplot(aes(x=reorder(State, -MedianABV), y=MedianABV)) +
  geom_col()

```

The plot above shows the median ABV values per state. The medians range from 6.25% to 4% with the highest median from Washington DC and the lowest median from Utah.

### Question 5

Which state has the maximum alcoholic (`ABV`) beer? Which state has the most bitter (`IBU`) beer?

```{r, fig.width=15, fig.height=7}
#Max IBUs
summary_df %>%
  ggplot(aes(x=reorder(State, -MaxIBU), y=MaxIBU)) +
  geom_col()

#Max ABVs 
summary_df %>%
  ggplot(aes(x=reorder(State, -MaxABV), y=MaxABV)) +
  geom_col()
```

The state producing the most bitter beer is Oregon with an IBU of 138. The state producing the most alcoholic beer is Colorado with an ABV of 12.8%.

### Question 6

Compute summary statistics for the ABV variable.

```{r, echo=TRUE}
merged_data %>%
  summary()
```

The following table summerizes the summary statistics for ABV.

| Statistic           | Value |
|--------------------:|------------------------:|
| mean                | 5.98%                   |
| median              | 5.60%                   |
| standard deviation  | 1.35 percentage points  |
| range               | 12.7 percentage points  |

### Question 7

Is there an apparent relationship between the bitterness of the beer and its alcoholic content? Draw a scatter plot.

```{r scatterplot/regression, echo=TRUE}

# fits best-fit line to scatter plot
merged_data %>%
  remove_missing(na.rm=TRUE) %>%
  ggplot(aes(x=IBU, y=ABV)) +
  geom_point(alpha=0.1) +
  geom_smooth(method="lm") + 
  labs(title="ABU vs IBU")

# model output
lm(ABV ~ IBU, data=merged_data) %>%
  summary()

# effect size
source("background_code/effect_size.R")
full_model <- lm(ABV ~ IBU, data=merged_data)
reduced_model <- lm(ABV ~ 1, data=merged_data)
get_effect_size(full_model, reduced_model)
```

The plot above is a scatter plot of ABV vs IBU. A simple linear regression yields strong evidence of a linear relationship (p-value < 0.0001). We find that a marginal increase in IBU increases ABV by 0.03%. We compute an effect size of 0.817 using Cohen's F-squared, which means that the proportion of the variance accounted for above and beyond the sample mean of ABV is very significant. 

TODO: Add scope of inference. Address missingness 


## Conclusion

TODO: Add conclusion to project; 
